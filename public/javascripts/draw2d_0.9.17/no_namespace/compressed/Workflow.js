/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Workflow=function(id){if(!id){return;}this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;this.figures=new ArrayList();this.lines=new ArrayList();this.commonPorts=new ArrayList();this.dropTargets=new ArrayList();this.compartments=new ArrayList();this.selectionListeners=new ArrayList();this.dialogs=new ArrayList();this.toolPalette=null;this.dragging=false;this.tooltip=null;this.draggingLine=null;this.draggingLineCommand=null;this.commandStack=new CommandStack();this.oldScrollPosLeft=0;this.oldScrollPosTop=0;this.currentSelection=null;this.currentMenu=null;this.connectionLine=new Line();this.resizeHandleStart=new LineStartResizeHandle(this);this.resizeHandleEnd=new LineEndResizeHandle(this);this.resizeHandle1=new ResizeHandle(this,1);this.resizeHandle2=new ResizeHandle(this,2);this.resizeHandle3=new ResizeHandle(this,3);this.resizeHandle4=new ResizeHandle(this,4);this.resizeHandle5=new ResizeHandle(this,5);this.resizeHandle6=new ResizeHandle(this,6);this.resizeHandle7=new ResizeHandle(this,7);this.resizeHandle8=new ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);Canvas.call(this,id);this.setPanning(false);if(this.html!=null){this.html.style.backgroundImage="url(grid_10.png)";oThis=this;this.html.tabIndex="0";var _166b=function(){var _166c=arguments[0]||window.event;var diffX=_166c.clientX;var diffY=_166c.clientY;var _166f=oThis.getScrollLeft();var _1670=oThis.getScrollTop();var _1671=oThis.getAbsoluteX();var _1672=oThis.getAbsoluteY();if(oThis.getBestFigure(diffX+_166f-_1671,diffY+_1670-_1672)!=null){return;}var line=oThis.getBestLine(diffX+_166f-_1671,diffY+_1670-_1672,null);if(line!=null){line.onContextMenu(diffX+_166f-_1671,diffY+_1670-_1672);}else{oThis.onContextMenu(diffX+_166f-_1671,diffY+_1670-_1672);}};this.html.oncontextmenu=function(){return false;};var oThis=this;var _1675=function(event){var ctrl=event.ctrlKey;oThis.onKeyDown(event.keyCode,ctrl);};var _1678=function(){var _1679=arguments[0]||window.event;if(_1679.returnValue==false){return;}var diffX=_1679.clientX;var diffY=_1679.clientY;var _167c=oThis.getScrollLeft();var _167d=oThis.getScrollTop();var _167e=oThis.getAbsoluteX();var _167f=oThis.getAbsoluteY();oThis.onMouseDown(diffX+_167c-_167e,diffY+_167d-_167f);};var _1680=function(){var _1681=arguments[0]||window.event;if(oThis.currentMenu!=null){oThis.removeFigure(oThis.currentMenu);oThis.currentMenu=null;}if(_1681.button==2){return;}var diffX=_1681.clientX;var diffY=_1681.clientY;var _1684=oThis.getScrollLeft();var _1685=oThis.getScrollTop();var _1686=oThis.getAbsoluteX();var _1687=oThis.getAbsoluteY();oThis.onMouseUp(diffX+_1684-_1686,diffY+_1685-_1687);};var _1688=function(){var _1689=arguments[0]||window.event;var diffX=_1689.clientX;var diffY=_1689.clientY;var _168c=oThis.getScrollLeft();var _168d=oThis.getScrollTop();var _168e=oThis.getAbsoluteX();var _168f=oThis.getAbsoluteY();oThis.currentMouseX=diffX+_168c-_168e;oThis.currentMouseY=diffY+_168d-_168f;var obj=oThis.getBestFigure(oThis.currentMouseX,oThis.currentMouseY);if(Drag.currentHover!=null&&obj==null){var _1691=new DragDropEvent();_1691.initDragDropEvent("mouseleave",false,oThis);Drag.currentHover.dispatchEvent(_1691);}else{var diffX=_1689.clientX;var diffY=_1689.clientY;var _168c=oThis.getScrollLeft();var _168d=oThis.getScrollTop();var _168e=oThis.getAbsoluteX();var _168f=oThis.getAbsoluteY();oThis.onMouseMove(diffX+_168c-_168e,diffY+_168d-_168f);}if(obj==null){Drag.currentHover=null;}if(oThis.tooltip!=null){if(Math.abs(oThis.currentTooltipX-oThis.currentMouseX)>10||Math.abs(oThis.currentTooltipY-oThis.currentMouseY)>10){oThis.showTooltip(null);}}};var _1692=function(_1693){var _1693=arguments[0]||window.event;var diffX=_1693.clientX;var diffY=_1693.clientY;var _1696=oThis.getScrollLeft();var _1697=oThis.getScrollTop();var _1698=oThis.getAbsoluteX();var _1699=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_1696-_1698,diffY+_1697-_1699,null);if(line!=null){line.onDoubleClick();}};if(this.html.addEventListener){this.html.addEventListener("contextmenu",_166b,false);this.html.addEventListener("mousemove",_1688,false);this.html.addEventListener("mouseup",_1680,false);this.html.addEventListener("mousedown",_1678,false);this.html.addEventListener("keydown",_1675,false);this.html.addEventListener("dblclick",_1692,false);}else{if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",_166b);this.html.attachEvent("onmousemove",_1688);this.html.attachEvent("onmousedown",_1678);this.html.attachEvent("onmouseup",_1680);this.html.attachEvent("onkeydown",_1675);this.html.attachEvent("ondblclick",_1692);}else{throw new Error("Open-jACOB Draw2D not supported in this browser.");}}}};Workflow.prototype=new Canvas;Workflow.prototype.type="Workflow";Workflow.COLOR_GREEN=new Color(0,255,0);Workflow.prototype.clear=function(){this.scrollTo(0,0,true);this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;var _169b=this.getDocument();var _169c=_169b.getLines().clone();for(var i=0;i<_169c.getSize();i++){new CommandDelete(_169c.get(i)).execute();}var _169e=_169b.getFigures().clone();for(var i=0;i<_169e.getSize();i++){new CommandDelete(_169e.get(i)).execute();}this.commonPorts.removeAllElements();this.dropTargets.removeAllElements();this.compartments.removeAllElements();this.selectionListeners.removeAllElements();this.dialogs.removeAllElements();this.commandStack=new CommandStack();this.currentSelection=null;this.currentMenu=null;Drag.clearCurrent();};Workflow.prototype.onScroll=function(){var _169f=this.getScrollLeft();var _16a0=this.getScrollTop();var _16a1=_169f-this.oldScrollPosLeft;var _16a2=_16a0-this.oldScrollPosTop;for(var i=0;i<this.figures.getSize();i++){var _16a4=this.figures.get(i);if(_16a4.hasFixedPosition&&_16a4.hasFixedPosition()==true){_16a4.setPosition(_16a4.getX()+_16a1,_16a4.getY()+_16a2);}}this.oldScrollPosLeft=_169f;this.oldScrollPosTop=_16a0;};Workflow.prototype.setPanning=function(flag){this.panning=flag;if(flag){this.html.style.cursor="move";}else{this.html.style.cursor="default";}};Workflow.prototype.scrollTo=function(x,y,fast){if(fast){this.scrollArea.scrollLeft=x;this.scrollArea.scrollTop=y;}else{var steps=40;var xStep=(x-this.getScrollLeft())/steps;var yStep=(y-this.getScrollTop())/steps;var oldX=this.getScrollLeft();var oldY=this.getScrollTop();for(var i=0;i<steps;i++){this.scrollArea.scrollLeft=oldX+(xStep*i);this.scrollArea.scrollTop=oldY+(yStep*i);}}};Workflow.prototype.showTooltip=function(_16af,_16b0){if(this.tooltip!=null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1;}}this.tooltip=_16af;if(this.tooltip!=null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var oThis=this;var _16b2=function(){oThis.tooltipTimer=-1;oThis.showTooltip(null);};if(_16b0==true){this.tooltipTimer=window.setTimeout(_16b2,5000);}}};Workflow.prototype.showDialog=function(_16b3,xPos,yPos){if(xPos){this.addFigure(_16b3,xPos,yPos);}else{this.addFigure(_16b3,200,100);}this.dialogs.add(_16b3);};Workflow.prototype.showMenu=function(menu,xPos,yPos){if(this.menu!=null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow();}this.menu=menu;if(this.menu!=null){this.menu.setWorkflow(this);this.menu.setPosition(xPos,yPos);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint();}};Workflow.prototype.onContextMenu=function(x,y){var menu=this.getContextMenu();if(menu!=null){this.showMenu(menu,x,y);}};Workflow.prototype.getContextMenu=function(){return null;};Workflow.prototype.setToolWindow=function(_16bc,x,y){this.toolPalette=_16bc;if(y){this.addFigure(_16bc,x,y);}else{this.addFigure(_16bc,20,20);}this.dialogs.add(_16bc);};Workflow.prototype.setSnapToGrid=function(flag){if(flag){this.snapToGridHelper=new SnapToGrid(this);}else{this.snapToGridHelper=null;}};Workflow.prototype.setSnapToGeometry=function(flag){if(flag){this.snapToGeometryHelper=new SnapToGeometry(this);}else{this.snapToGeometryHelper=null;}};Workflow.prototype.setGridWidth=function(dx,dy){this.gridWidthX=dx;this.gridWidthY=dy;};Workflow.prototype.addFigure=function(_16c3,xPos,yPos){Canvas.prototype.addFigure.call(this,_16c3,xPos,yPos,true);_16c3.setWorkflow(this);var _16c6=this;if(_16c3 instanceof CompartmentFigure){this.compartments.add(_16c3);}if(_16c3 instanceof Line){this.lines.add(_16c3);}else{this.figures.add(_16c3);_16c3.draggable.addEventListener("drag",function(_16c7){var _16c8=_16c6.getFigure(_16c7.target.element.id);if(_16c8==null){return;}if(_16c8.isSelectable()==false){return;}_16c6.moveResizeHandles(_16c8);});}_16c3.paint();this.setDocumentDirty();};Workflow.prototype.removeFigure=function(_16c9){Canvas.prototype.removeFigure.call(this,_16c9);this.figures.remove(_16c9);this.lines.remove(_16c9);this.dialogs.remove(_16c9);_16c9.setWorkflow(null);if(_16c9 instanceof CompartmentFigure){this.compartments.remove(_16c9);}if(_16c9 instanceof Connection){_16c9.disconnect();}if(this.currentSelection==_16c9){this.setCurrentSelection(null);}this.setDocumentDirty();};Workflow.prototype.moveFront=function(_16ca){this.html.removeChild(_16ca.getHTMLElement());this.html.appendChild(_16ca.getHTMLElement());};Workflow.prototype.moveBack=function(_16cb){this.html.removeChild(_16cb.getHTMLElement());this.html.insertBefore(_16cb.getHTMLElement(),this.html.firstChild);};Workflow.prototype.getBestCompartmentFigure=function(x,y,_16ce){var _16cf=null;for(var i=0;i<this.figures.getSize();i++){var _16d1=this.figures.get(i);if((_16d1 instanceof CompartmentFigure)&&_16d1.isOver(x,y)==true&&_16d1!=_16ce){if(_16cf==null){_16cf=_16d1;}else{if(_16cf.getZOrder()<_16d1.getZOrder()){_16cf=_16d1;}}}}return _16cf;};Workflow.prototype.getBestFigure=function(x,y,_16d4){var _16d5=null;for(var i=0;i<this.figures.getSize();i++){var _16d7=this.figures.get(i);if(_16d7.isOver(x,y)==true&&_16d7!=_16d4){if(_16d5==null){_16d5=_16d7;}else{if(_16d5.getZOrder()<_16d7.getZOrder()){_16d5=_16d7;}}}}return _16d5;};Workflow.prototype.getBestLine=function(x,y,_16da){var _16db=null;var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.containsPoint(x,y)==true&&line!=_16da){if(_16db==null){_16db=line;}else{if(_16db.getZOrder()<line.getZOrder()){_16db=line;}}}}return _16db;};Workflow.prototype.getFigure=function(id){for(var i=0;i<this.figures.getSize();i++){var _16e1=this.figures.get(i);if(_16e1.id==id){return _16e1;}}return null;};Workflow.prototype.getFigures=function(){return this.figures;};Workflow.prototype.getDocument=function(){return new CanvasDocument(this);};Workflow.prototype.addSelectionListener=function(w){if(w!=null){this.selectionListeners.add(w);}};Workflow.prototype.removeSelectionListener=function(w){this.selectionListeners.remove(w);};Workflow.prototype.setCurrentSelection=function(_16e4){if(_16e4==null){this.hideResizeHandles();this.hideLineResizeHandles();}this.currentSelection=_16e4;for(var i=0;i<this.selectionListeners.getSize();i++){var w=this.selectionListeners.get(i);if(w.onSelectionChanged){w.onSelectionChanged(this.currentSelection);}}};Workflow.prototype.getCurrentSelection=function(){return this.currentSelection;};Workflow.prototype.getLine=function(id){var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.getId()==id){return line;}}return null;};Workflow.prototype.getLines=function(){return this.lines;};Workflow.prototype.registerPort=function(port){port.draggable.targets=this.dropTargets;this.commonPorts.add(port);this.dropTargets.add(port.dropable);};Workflow.prototype.unregisterPort=function(port){port.draggable.targets=null;this.commonPorts.remove(port);this.dropTargets.remove(port.dropable);};Workflow.prototype.getCommandStack=function(){return this.commandStack;};Workflow.prototype.showConnectionLine=function(x1,y1,x2,y2){this.connectionLine.setStartPoint(x1,y1);this.connectionLine.setEndPoint(x2,y2);if(this.connectionLine.canvas==null){Canvas.prototype.addFigure.call(this,this.connectionLine);}};Workflow.prototype.hideConnectionLine=function(){if(this.connectionLine.canvas!=null){Canvas.prototype.removeFigure.call(this,this.connectionLine);}};Workflow.prototype.showLineResizeHandles=function(_16f1){var _16f2=this.resizeHandleStart.getWidth()/2;var _16f3=this.resizeHandleStart.getHeight()/2;var _16f4=_16f1.getStartPoint();var _16f5=_16f1.getEndPoint();Canvas.prototype.addFigure.call(this,this.resizeHandleStart,_16f4.x-_16f2,_16f4.y-_16f2);Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,_16f5.x-_16f2,_16f5.y-_16f2);this.resizeHandleStart.setCanDrag(_16f1.isResizeable());this.resizeHandleEnd.setCanDrag(_16f1.isResizeable());if(_16f1.isResizeable()){this.resizeHandleStart.setBackgroundColor(Workflow.COLOR_GREEN);this.resizeHandleEnd.setBackgroundColor(Workflow.COLOR_GREEN);this.resizeHandleStart.draggable.targets=this.dropTargets;this.resizeHandleEnd.draggable.targets=this.dropTargets;}else{this.resizeHandleStart.setBackgroundColor(null);this.resizeHandleEnd.setBackgroundColor(null);}};Workflow.prototype.hideLineResizeHandles=function(){if(this.resizeHandleStart.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);}if(this.resizeHandleEnd.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd);}};Workflow.prototype.showResizeHandles=function(_16f6){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=_16f6){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01);}var _16f7=this.resizeHandle1.getWidth();var _16f8=this.resizeHandle1.getHeight();var _16f9=_16f6.getHeight();var _16fa=_16f6.getWidth();var xPos=_16f6.getX();var yPos=_16f6.getY();Canvas.prototype.addFigure.call(this,this.resizeHandle1,xPos-_16f7,yPos-_16f8);Canvas.prototype.addFigure.call(this,this.resizeHandle3,xPos+_16fa,yPos-_16f8);Canvas.prototype.addFigure.call(this,this.resizeHandle5,xPos+_16fa,yPos+_16f9);Canvas.prototype.addFigure.call(this,this.resizeHandle7,xPos-_16f7,yPos+_16f9);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(_16f6.isResizeable());this.resizeHandle3.setCanDrag(_16f6.isResizeable());this.resizeHandle5.setCanDrag(_16f6.isResizeable());this.resizeHandle7.setCanDrag(_16f6.isResizeable());if(_16f6.isResizeable()){var green=new Color(0,255,0);this.resizeHandle1.setBackgroundColor(green);this.resizeHandle3.setBackgroundColor(green);this.resizeHandle5.setBackgroundColor(green);this.resizeHandle7.setBackgroundColor(green);}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null);}if(_16f6.isStrechable()&&_16f6.isResizeable()){this.resizeHandle2.setCanDrag(_16f6.isResizeable());this.resizeHandle4.setCanDrag(_16f6.isResizeable());this.resizeHandle6.setCanDrag(_16f6.isResizeable());this.resizeHandle8.setCanDrag(_16f6.isResizeable());Canvas.prototype.addFigure.call(this,this.resizeHandle2,xPos+(_16fa/2)-this.resizeHandleHalfWidth,yPos-_16f8);Canvas.prototype.addFigure.call(this,this.resizeHandle4,xPos+_16fa,yPos+(_16f9/2)-(_16f8/2));Canvas.prototype.addFigure.call(this,this.resizeHandle6,xPos+(_16fa/2)-this.resizeHandleHalfWidth,yPos+_16f9);Canvas.prototype.addFigure.call(this,this.resizeHandle8,xPos-_16f7,yPos+(_16f9/2)-(_16f8/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8);}};Workflow.prototype.hideResizeHandles=function(){if(this.resizeHandle1.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle1);}if(this.resizeHandle2.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle2);}if(this.resizeHandle3.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle3);}if(this.resizeHandle4.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle4);}if(this.resizeHandle5.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle5);}if(this.resizeHandle6.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle6);}if(this.resizeHandle7.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle7);}if(this.resizeHandle8.canvas!=null){Canvas.prototype.removeFigure.call(this,this.resizeHandle8);}};Workflow.prototype.moveResizeHandles=function(_16fe){var _16ff=this.resizeHandle1.getWidth();var _1700=this.resizeHandle1.getHeight();var _1701=_16fe.getHeight();var _1702=_16fe.getWidth();var xPos=_16fe.getX();var yPos=_16fe.getY();this.resizeHandle1.setPosition(xPos-_16ff,yPos-_1700);this.resizeHandle3.setPosition(xPos+_1702,yPos-_1700);this.resizeHandle5.setPosition(xPos+_1702,yPos+_1701);this.resizeHandle7.setPosition(xPos-_16ff,yPos+_1701);if(_16fe.isStrechable()){this.resizeHandle2.setPosition(xPos+(_1702/2)-this.resizeHandleHalfWidth,yPos-_1700);this.resizeHandle4.setPosition(xPos+_1702,yPos+(_1701/2)-(_1700/2));this.resizeHandle6.setPosition(xPos+(_1702/2)-this.resizeHandleHalfWidth,yPos+_1701);this.resizeHandle8.setPosition(xPos-_16ff,yPos+(_1701/2)-(_1700/2));}};Workflow.prototype.onMouseDown=function(x,y){this.dragging=true;this.mouseDownPosX=x;this.mouseDownPosY=y;if(this.toolPalette!=null&&this.toolPalette.getActiveTool()!=null){this.toolPalette.getActiveTool().execute(x,y);}this.setCurrentSelection(null);this.showMenu(null);var line=this.getBestLine(x,y);if(line!=null&&line.isSelectable()){this.hideResizeHandles();this.setCurrentSelection(line);this.showLineResizeHandles(this.currentSelection);if(line instanceof Line&&!(line instanceof Connection)){this.draggingLineCommand=line.createCommand(new EditPolicy(EditPolicy.MOVE));if(this.draggingLineCommand!=null){this.draggingLine=line;}}}};Workflow.prototype.onMouseUp=function(x,y){this.dragging=false;if(this.draggingLineCommand!=null){this.getCommandStack().execute(this.draggingLineCommand);this.draggingLine=null;this.draggingLineCommand=null;}};Workflow.prototype.onMouseMove=function(x,y){if(this.dragging==true&&this.draggingLine!=null){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+diffX;this.draggingLine.startY=this.draggingLine.getStartY()+diffY;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+diffX,this.draggingLine.getEndY()+diffY);this.mouseDownPosX=x;this.mouseDownPosY=y;this.showLineResizeHandles(this.currentSelection);}else{if(this.dragging==true&&this.panning==true){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-diffX,this.getScrollTop()-diffY,true);this.onScroll();}}};Workflow.prototype.onKeyDown=function(_170e,ctrl){if(_170e==46&&this.currentSelection!=null){this.commandStack.execute(this.currentSelection.createCommand(new EditPolicy(EditPolicy.DELETE)));}else{if(_170e==90&&ctrl){this.commandStack.undo();}else{if(_170e==89&&ctrl){this.commandStack.redo();}}}};Workflow.prototype.setDocumentDirty=function(){for(var i=0;i<this.dialogs.getSize();i++){var d=this.dialogs.get(i);if(d!=null&&d.onSetDocumentDirty){d.onSetDocumentDirty();}}if(this.snapToGeometryHelper!=null){this.snapToGeometryHelper.onSetDocumentDirty();}if(this.snapToGridHelper!=null){this.snapToGridHelper.onSetDocumentDirty();}};Workflow.prototype.snapToHelper=function(_1712,pos){if(this.snapToGeometryHelper!=null){if(_1712 instanceof ResizeHandle){var _1714=_1712.getSnapToGridAnchor();pos.x+=_1714.x;pos.y+=_1714.y;var _1715=new Point(pos.x,pos.y);var _1716=_1712.getSnapToDirection();var _1717=this.snapToGeometryHelper.snapPoint(_1716,pos,_1715);if((_1716&SnapToHelper.EAST_WEST)&&!(_1717&SnapToHelper.EAST_WEST)){this.showSnapToHelperLineVertical(_1715.x);}else{this.hideSnapToHelperLineVertical();}if((_1716&SnapToHelper.NORTH_SOUTH)&&!(_1717&SnapToHelper.NORTH_SOUTH)){this.showSnapToHelperLineHorizontal(_1715.y);}else{this.hideSnapToHelperLineHorizontal();}_1715.x-=_1714.x;_1715.y-=_1714.y;return _1715;}else{var _1718=new Dimension(pos.x,pos.y,_1712.getWidth(),_1712.getHeight());var _1715=new Dimension(pos.x,pos.y,_1712.getWidth(),_1712.getHeight());var _1716=SnapToHelper.NSEW;var _1717=this.snapToGeometryHelper.snapRectangle(_1718,_1715);if((_1716&SnapToHelper.WEST)&&!(_1717&SnapToHelper.WEST)){this.showSnapToHelperLineVertical(_1715.x);}else{if((_1716&SnapToHelper.EAST)&&!(_1717&SnapToHelper.EAST)){this.showSnapToHelperLineVertical(_1715.getX()+_1715.getWidth());}else{this.hideSnapToHelperLineVertical();}}if((_1716&SnapToHelper.NORTH)&&!(_1717&SnapToHelper.NORTH)){this.showSnapToHelperLineHorizontal(_1715.y);}else{if((_1716&SnapToHelper.SOUTH)&&!(_1717&SnapToHelper.SOUTH)){this.showSnapToHelperLineHorizontal(_1715.getY()+_1715.getHeight());}else{this.hideSnapToHelperLineHorizontal();}}return _1715.getTopLeft();}}else{if(this.snapToGridHelper!=null){var _1714=_1712.getSnapToGridAnchor();pos.x=pos.x+_1714.x;pos.y=pos.y+_1714.y;var _1715=new Point(pos.x,pos.y);this.snapToGridHelper.snapPoint(0,pos,_1715);_1715.x=_1715.x-_1714.x;_1715.y=_1715.y-_1714.y;return _1715;}}return pos;};Workflow.prototype.showSnapToHelperLineHorizontal=function(_1719){if(this.horizontalSnapToHelperLine==null){this.horizontalSnapToHelperLine=new Line();this.horizontalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine);}this.horizontalSnapToHelperLine.setStartPoint(0,_1719);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),_1719);};Workflow.prototype.showSnapToHelperLineVertical=function(_171a){if(this.verticalSnapToHelperLine==null){this.verticalSnapToHelperLine=new Line();this.verticalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine);}this.verticalSnapToHelperLine.setStartPoint(_171a,0);this.verticalSnapToHelperLine.setEndPoint(_171a,this.getHeight());};Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical();};Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!=null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null;}};Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!=null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null;}};