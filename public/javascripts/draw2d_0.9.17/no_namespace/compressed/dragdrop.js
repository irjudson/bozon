/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Drag=function(){};Drag.current=null;Drag.currentTarget=null;Drag.dragging=false;Drag.isDragging=function(){return this.dragging;};Drag.setCurrent=function(_5ff){this.current=_5ff;this.dragging=true;};Drag.getCurrent=function(){return this.current;};Drag.clearCurrent=function(){this.current=null;this.dragging=false;this.currentTarget=null;};Draggable=function(_600,_601){EventTarget.call(this);this.construct(_600,_601);this.diffX=0;this.diffY=0;this.targets=new ArrayList();};Draggable.prototype=new EventTarget;Draggable.prototype.construct=function(_602,_603){this.element=_602;this.constraints=_603;var _604=this;var _605=function(){var _606=new DragDropEvent();_606.initDragDropEvent("dblclick",true);_604.dispatchEvent(_606);var _607=arguments[0]||window.event;_607.cancelBubble=true;_607.returnValue=false;};var _608=function(){var _609=arguments[0]||window.event;var _60a=new DragDropEvent();var _60b=_604.node.workflow.getAbsoluteX();var _60c=_604.node.workflow.getAbsoluteY();var _60d=_604.node.workflow.getScrollLeft();var _60e=_604.node.workflow.getScrollTop();_60a.x=_609.clientX-_604.element.offsetLeft+_60d-_60b;_60a.y=_609.clientY-_604.element.offsetTop+_60e-_60c;if(_609.button==2){_60a.initDragDropEvent("contextmenu",true);_604.dispatchEvent(_60a);}else{_60a.initDragDropEvent("dragstart",true);if(_604.dispatchEvent(_60a)){_604.diffX=_609.clientX-_604.element.offsetLeft;_604.diffY=_609.clientY-_604.element.offsetTop;Drag.setCurrent(_604);if(_604.isAttached==true){_604.detachEventHandlers();}_604.attachEventHandlers();}}_609.cancelBubble=true;_609.returnValue=false;};var _60f=function(){if(Drag.getCurrent()==null){var _610=arguments[0]||window.event;if(Drag.currentHover!=null&&_604!=Drag.currentHover){var _611=new DragDropEvent();_611.initDragDropEvent("mouseleave",false,_604);Drag.currentHover.dispatchEvent(_611);}if(_604!=null&&_604!=Drag.currentHover){var _611=new DragDropEvent();_611.initDragDropEvent("mouseenter",false,_604);_604.dispatchEvent(_611);}Drag.currentHover=_604;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_60f,false);this.element.addEventListener("mousedown",_608,false);this.element.addEventListener("dblclick",_605,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_60f);this.element.attachEvent("onmousedown",_608);this.element.attachEvent("ondblclick",_605);}else{throw new Error("Drag not supported in this browser.");}}};Draggable.prototype.attachEventHandlers=function(){var _612=this;_612.isAttached=true;this.tempMouseMove=function(){var _613=arguments[0]||window.event;var _614=new Point(_613.clientX-_612.diffX,_613.clientY-_612.diffY);if(_612.node.getCanSnapToHelper()){_614=_612.node.getWorkflow().snapToHelper(_612.node,_614);}_612.element.style.left=_614.x+"px";_612.element.style.top=_614.y+"px";var _615=_612.node.workflow.getScrollLeft();var _616=_612.node.workflow.getScrollTop();var _617=_612.node.workflow.getAbsoluteX();var _618=_612.node.workflow.getAbsoluteY();var _619=_612.getDropTarget(_613.clientX+_615-_617,_613.clientY+_616-_618);var _61a=_612.getCompartment(_613.clientX+_615-_617,_613.clientY+_616-_618);if(Drag.currentTarget!=null&&_619!=Drag.currentTarget){var _61b=new DragDropEvent();_61b.initDragDropEvent("dragleave",false,_612);Drag.currentTarget.dispatchEvent(_61b);}if(_619!=null&&_619!=Drag.currentTarget){var _61b=new DragDropEvent();_61b.initDragDropEvent("dragenter",false,_612);_619.dispatchEvent(_61b);}Drag.currentTarget=_619;if(Drag.currentCompartment!=null&&_61a!=Drag.currentCompartment){var _61b=new DragDropEvent();_61b.initDragDropEvent("figureleave",false,_612);Drag.currentCompartment.dispatchEvent(_61b);}if(_61a!=null&&_61a.node!=_612.node&&_61a!=Drag.currentCompartment){var _61b=new DragDropEvent();_61b.initDragDropEvent("figureenter",false,_612);_61a.dispatchEvent(_61b);}Drag.currentCompartment=_61a;var _61c=new DragDropEvent();_61c.initDragDropEvent("drag",false);_612.dispatchEvent(_61c);};_612.tempMouseUp=function(){_612.detachEventHandlers();var _61d=arguments[0]||window.event;var _61e=_612.node.workflow.getScrollLeft();var _61f=_612.node.workflow.getScrollTop();var _620=_612.node.workflow.getAbsoluteX();var _621=_612.node.workflow.getAbsoluteY();var _622=_612.getDropTarget(_61d.clientX+_61e-_620,_61d.clientY+_61f-_621);var _623=_612.getCompartment(_61d.clientX+_61e-_620,_61d.clientY+_61f-_621);if(_622!=null){var _624=new DragDropEvent();_624.initDragDropEvent("drop",false,_612);_622.dispatchEvent(_624);}if(_623!=null&&_623.node!=_612.node){var _624=new DragDropEvent();_624.initDragDropEvent("figuredrop",false,_612);_623.dispatchEvent(_624);}if(Drag.currentTarget!=null){var _624=new DragDropEvent();_624.initDragDropEvent("dragleave",false,_612);Drag.currentTarget.dispatchEvent(_624);Drag.currentTarget=null;}var _625=new DragDropEvent();_625.initDragDropEvent("dragend",false);_612.dispatchEvent(_625);Drag.currentCompartment=null;Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _629=this.targets.get(i);if(_629.node.isOver(x,y)&&_629.node!=this.node){return _629;}}return null;};Draggable.prototype.getCompartment=function(x,y){var _62c=null;for(var i=0;i<this.node.workflow.compartments.getSize();i++){var _62e=this.node.workflow.compartments.get(i);if(_62e.isOver(x,y)&&_62e!=this.node){if(_62c==null){_62c=_62e;}else{if(_62c.getZOrder()<_62e.getZOrder()){_62c=_62e;}}}}return _62c==null?null:_62c.dropable;};Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};Draggable.prototype.getTop=function(){return this.element.offsetTop;};DragDropEvent=function(){Event.call(this);};DragDropEvent.prototype=new Event();DragDropEvent.prototype.initDragDropEvent=function(_62f,_630,_631){this.initEvent(_62f,_630);this.relatedTarget=_631;};DropTarget=function(_632){EventTarget.call(this);this.construct(_632);};DropTarget.prototype=new EventTarget;DropTarget.prototype.construct=function(_633){this.element=_633;};DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!=null){ol+=el.offsetLeft;}return ol;};DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!=null){ot+=el.offsetTop;}return ot;};DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};