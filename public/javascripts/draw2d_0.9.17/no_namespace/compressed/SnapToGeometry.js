/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

SnapToGeometry=function(_163d){SnapToHelper.call(this,_163d);};SnapToGeometry.prototype=new SnapToHelper;SnapToGeometry.THRESHOLD=5;SnapToGeometry.prototype.snapPoint=function(_163e,_163f,_1640){if(this.rows==null||this.cols==null){this.populateRowsAndCols();}if((_163e&SnapToHelper.EAST)!=0){var _1641=this.getCorrectionFor(this.cols,_163f.getX()-1,1);if(_1641!=SnapToGeometry.THRESHOLD){_163e&=~SnapToHelper.EAST;_1640.x+=_1641;}}if((_163e&SnapToHelper.WEST)!=0){var _1642=this.getCorrectionFor(this.cols,_163f.getX(),-1);if(_1642!=SnapToGeometry.THRESHOLD){_163e&=~SnapToHelper.WEST;_1640.x+=_1642;}}if((_163e&SnapToHelper.SOUTH)!=0){var _1643=this.getCorrectionFor(this.rows,_163f.getY()-1,1);if(_1643!=SnapToGeometry.THRESHOLD){_163e&=~SnapToHelper.SOUTH;_1640.y+=_1643;}}if((_163e&SnapToHelper.NORTH)!=0){var _1644=this.getCorrectionFor(this.rows,_163f.getY(),-1);if(_1644!=SnapToGeometry.THRESHOLD){_163e&=~SnapToHelper.NORTH;_1640.y+=_1644;}}return _163e;};SnapToGeometry.prototype.snapRectangle=function(_1645,_1646){var _1647=_1645.getTopLeft();var _1648=_1645.getBottomRight();var _1649=this.snapPoint(SnapToHelper.NORTH_WEST,_1645.getTopLeft(),_1647);_1646.x=_1647.x;_1646.y=_1647.y;var _164a=this.snapPoint(SnapToHelper.SOUTH_EAST,_1645.getBottomRight(),_1648);if(_1649&SnapToHelper.WEST){_1646.x=_1648.x-_1645.getWidth();}if(_1649&SnapToHelper.NORTH){_1646.y=_1648.y-_1645.getHeight();}return _1649|_164a;};SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=new Array();this.cols=new Array();var _164b=this.workflow.getDocument().getFigures();var index=0;for(var i=0;i<_164b.getSize();i++){var _164e=_164b.get(i);if(_164e!=this.workflow.getCurrentSelection()){var _164f=_164e.getBounds();this.cols[index*3]=new SnapToGeometryEntry(-1,_164f.getX());this.rows[index*3]=new SnapToGeometryEntry(-1,_164f.getY());this.cols[index*3+1]=new SnapToGeometryEntry(0,_164f.x+(_164f.getWidth()-1)/2);this.rows[index*3+1]=new SnapToGeometryEntry(0,_164f.y+(_164f.getHeight()-1)/2);this.cols[index*3+2]=new SnapToGeometryEntry(1,_164f.getRight()-1);this.rows[index*3+2]=new SnapToGeometryEntry(1,_164f.getBottom()-1);index++;}}};SnapToGeometry.prototype.getCorrectionFor=function(_1650,value,side){var _1653=SnapToGeometry.THRESHOLD;var _1654=SnapToGeometry.THRESHOLD;for(var i=0;i<_1650.length;i++){var entry=_1650[i];var _1657;if(entry.type==-1&&side!=0){_1657=Math.abs(value-entry.location);if(_1657<_1653){_1653=_1657;_1654=entry.location-value;}}else{if(entry.type==0&&side==0){_1657=Math.abs(value-entry.location);if(_1657<_1653){_1653=_1657;_1654=entry.location-value;}}else{if(entry.type==1&&side!=0){_1657=Math.abs(value-entry.location);if(_1657<_1653){_1653=_1657;_1654=entry.location-value;}}}}}return _1654;};SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};