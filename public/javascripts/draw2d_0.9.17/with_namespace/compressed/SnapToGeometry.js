/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.SnapToGeometry=function(_1e4a){draw2d.SnapToHelper.call(this,_1e4a);};draw2d.SnapToGeometry.prototype=new draw2d.SnapToHelper;draw2d.SnapToGeometry.THRESHOLD=5;draw2d.SnapToGeometry.prototype.snapPoint=function(_1e4b,_1e4c,_1e4d){if(this.rows==null||this.cols==null){this.populateRowsAndCols();}if((_1e4b&draw2d.SnapToHelper.EAST)!=0){var _1e4e=this.getCorrectionFor(this.cols,_1e4c.getX()-1,1);if(_1e4e!=draw2d.SnapToGeometry.THRESHOLD){_1e4b&=~draw2d.SnapToHelper.EAST;_1e4d.x+=_1e4e;}}if((_1e4b&draw2d.SnapToHelper.WEST)!=0){var _1e4f=this.getCorrectionFor(this.cols,_1e4c.getX(),-1);if(_1e4f!=draw2d.SnapToGeometry.THRESHOLD){_1e4b&=~draw2d.SnapToHelper.WEST;_1e4d.x+=_1e4f;}}if((_1e4b&draw2d.SnapToHelper.SOUTH)!=0){var _1e50=this.getCorrectionFor(this.rows,_1e4c.getY()-1,1);if(_1e50!=draw2d.SnapToGeometry.THRESHOLD){_1e4b&=~draw2d.SnapToHelper.SOUTH;_1e4d.y+=_1e50;}}if((_1e4b&draw2d.SnapToHelper.NORTH)!=0){var _1e51=this.getCorrectionFor(this.rows,_1e4c.getY(),-1);if(_1e51!=draw2d.SnapToGeometry.THRESHOLD){_1e4b&=~draw2d.SnapToHelper.NORTH;_1e4d.y+=_1e51;}}return _1e4b;};draw2d.SnapToGeometry.prototype.snapRectangle=function(_1e52,_1e53){var _1e54=_1e52.getTopLeft();var _1e55=_1e52.getBottomRight();var _1e56=this.snapPoint(draw2d.SnapToHelper.NORTH_WEST,_1e52.getTopLeft(),_1e54);_1e53.x=_1e54.x;_1e53.y=_1e54.y;var _1e57=this.snapPoint(draw2d.SnapToHelper.SOUTH_EAST,_1e52.getBottomRight(),_1e55);if(_1e56&draw2d.SnapToHelper.WEST){_1e53.x=_1e55.x-_1e52.getWidth();}if(_1e56&draw2d.SnapToHelper.NORTH){_1e53.y=_1e55.y-_1e52.getHeight();}return _1e56|_1e57;};draw2d.SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=new Array();this.cols=new Array();var _1e58=this.workflow.getDocument().getFigures();var index=0;for(var i=0;i<_1e58.getSize();i++){var _1e5b=_1e58.get(i);if(_1e5b!=this.workflow.getCurrentSelection()){var _1e5c=_1e5b.getBounds();this.cols[index*3]=new draw2d.SnapToGeometryEntry(-1,_1e5c.getX());this.rows[index*3]=new draw2d.SnapToGeometryEntry(-1,_1e5c.getY());this.cols[index*3+1]=new draw2d.SnapToGeometryEntry(0,_1e5c.x+(_1e5c.getWidth()-1)/2);this.rows[index*3+1]=new draw2d.SnapToGeometryEntry(0,_1e5c.y+(_1e5c.getHeight()-1)/2);this.cols[index*3+2]=new draw2d.SnapToGeometryEntry(1,_1e5c.getRight()-1);this.rows[index*3+2]=new draw2d.SnapToGeometryEntry(1,_1e5c.getBottom()-1);index++;}}};draw2d.SnapToGeometry.prototype.getCorrectionFor=function(_1e5d,value,side){var _1e60=draw2d.SnapToGeometry.THRESHOLD;var _1e61=draw2d.SnapToGeometry.THRESHOLD;for(var i=0;i<_1e5d.length;i++){var entry=_1e5d[i];var _1e64;if(entry.type==-1&&side!=0){_1e64=Math.abs(value-entry.location);if(_1e64<_1e60){_1e60=_1e64;_1e61=entry.location-value;}}else{if(entry.type==0&&side==0){_1e64=Math.abs(value-entry.location);if(_1e64<_1e60){_1e60=_1e64;_1e61=entry.location-value;}}else{if(entry.type==1&&side!=0){_1e64=Math.abs(value-entry.location);if(_1e64<_1e60){_1e60=_1e64;_1e61=entry.location-value;}}}}}return _1e61;};draw2d.SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};