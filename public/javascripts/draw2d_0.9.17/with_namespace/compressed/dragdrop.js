/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.Drag=function(){};draw2d.Drag.current=null;draw2d.Drag.currentTarget=null;draw2d.Drag.dragging=false;draw2d.Drag.isDragging=function(){return this.dragging;};draw2d.Drag.setCurrent=function(_1b4b){this.current=_1b4b;this.dragging=true;};draw2d.Drag.getCurrent=function(){return this.current;};draw2d.Drag.clearCurrent=function(){this.current=null;this.dragging=false;this.currentTarget=null;};draw2d.Draggable=function(_1b4c,_1b4d){draw2d.EventTarget.call(this);this.construct(_1b4c,_1b4d);this.diffX=0;this.diffY=0;this.targets=new draw2d.ArrayList();};draw2d.Draggable.prototype=new draw2d.EventTarget;draw2d.Draggable.prototype.construct=function(_1b4e,_1b4f){this.element=_1b4e;this.constraints=_1b4f;var oThis=this;var _1b51=function(){var _1b52=new draw2d.DragDropEvent();_1b52.initDragDropEvent("dblclick",true);oThis.dispatchEvent(_1b52);var _1b53=arguments[0]||window.event;_1b53.cancelBubble=true;_1b53.returnValue=false;};var _1b54=function(){var _1b55=arguments[0]||window.event;var _1b56=new draw2d.DragDropEvent();var _1b57=oThis.node.workflow.getAbsoluteX();var _1b58=oThis.node.workflow.getAbsoluteY();var _1b59=oThis.node.workflow.getScrollLeft();var _1b5a=oThis.node.workflow.getScrollTop();_1b56.x=_1b55.clientX-oThis.element.offsetLeft+_1b59-_1b57;_1b56.y=_1b55.clientY-oThis.element.offsetTop+_1b5a-_1b58;if(_1b55.button==2){_1b56.initDragDropEvent("contextmenu",true);oThis.dispatchEvent(_1b56);}else{_1b56.initDragDropEvent("dragstart",true);if(oThis.dispatchEvent(_1b56)){oThis.diffX=_1b55.clientX-oThis.element.offsetLeft;oThis.diffY=_1b55.clientY-oThis.element.offsetTop;draw2d.Drag.setCurrent(oThis);if(oThis.isAttached==true){oThis.detachEventHandlers();}oThis.attachEventHandlers();}}_1b55.cancelBubble=true;_1b55.returnValue=false;};var _1b5b=function(){if(draw2d.Drag.getCurrent()==null){var _1b5c=arguments[0]||window.event;if(draw2d.Drag.currentHover!=null&&oThis!=draw2d.Drag.currentHover){var _1b5d=new draw2d.DragDropEvent();_1b5d.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_1b5d);}if(oThis!=null&&oThis!=draw2d.Drag.currentHover){var _1b5d=new draw2d.DragDropEvent();_1b5d.initDragDropEvent("mouseenter",false,oThis);oThis.dispatchEvent(_1b5d);}draw2d.Drag.currentHover=oThis;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_1b5b,false);this.element.addEventListener("mousedown",_1b54,false);this.element.addEventListener("dblclick",_1b51,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_1b5b);this.element.attachEvent("onmousedown",_1b54);this.element.attachEvent("ondblclick",_1b51);}else{throw new Error("Drag not supported in this browser.");}}};draw2d.Draggable.prototype.attachEventHandlers=function(){var oThis=this;oThis.isAttached=true;this.tempMouseMove=function(){var _1b5f=arguments[0]||window.event;var _1b60=new draw2d.Point(_1b5f.clientX-oThis.diffX,_1b5f.clientY-oThis.diffY);if(oThis.node.getCanSnapToHelper()){_1b60=oThis.node.getWorkflow().snapToHelper(oThis.node,_1b60);}oThis.element.style.left=_1b60.x+"px";oThis.element.style.top=_1b60.y+"px";var _1b61=oThis.node.workflow.getScrollLeft();var _1b62=oThis.node.workflow.getScrollTop();var _1b63=oThis.node.workflow.getAbsoluteX();var _1b64=oThis.node.workflow.getAbsoluteY();var _1b65=oThis.getDropTarget(_1b5f.clientX+_1b61-_1b63,_1b5f.clientY+_1b62-_1b64);var _1b66=oThis.getCompartment(_1b5f.clientX+_1b61-_1b63,_1b5f.clientY+_1b62-_1b64);if(draw2d.Drag.currentTarget!=null&&_1b65!=draw2d.Drag.currentTarget){var _1b67=new draw2d.DragDropEvent();_1b67.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_1b67);}if(_1b65!=null&&_1b65!=draw2d.Drag.currentTarget){var _1b67=new draw2d.DragDropEvent();_1b67.initDragDropEvent("dragenter",false,oThis);_1b65.dispatchEvent(_1b67);}draw2d.Drag.currentTarget=_1b65;if(draw2d.Drag.currentCompartment!=null&&_1b66!=draw2d.Drag.currentCompartment){var _1b67=new draw2d.DragDropEvent();_1b67.initDragDropEvent("figureleave",false,oThis);draw2d.Drag.currentCompartment.dispatchEvent(_1b67);}if(_1b66!=null&&_1b66.node!=oThis.node&&_1b66!=draw2d.Drag.currentCompartment){var _1b67=new draw2d.DragDropEvent();_1b67.initDragDropEvent("figureenter",false,oThis);_1b66.dispatchEvent(_1b67);}draw2d.Drag.currentCompartment=_1b66;var _1b68=new draw2d.DragDropEvent();_1b68.initDragDropEvent("drag",false);oThis.dispatchEvent(_1b68);};oThis.tempMouseUp=function(){oThis.detachEventHandlers();var _1b69=arguments[0]||window.event;var _1b6a=oThis.node.workflow.getScrollLeft();var _1b6b=oThis.node.workflow.getScrollTop();var _1b6c=oThis.node.workflow.getAbsoluteX();var _1b6d=oThis.node.workflow.getAbsoluteY();var _1b6e=oThis.getDropTarget(_1b69.clientX+_1b6a-_1b6c,_1b69.clientY+_1b6b-_1b6d);var _1b6f=oThis.getCompartment(_1b69.clientX+_1b6a-_1b6c,_1b69.clientY+_1b6b-_1b6d);if(_1b6e!=null){var _1b70=new draw2d.DragDropEvent();_1b70.initDragDropEvent("drop",false,oThis);_1b6e.dispatchEvent(_1b70);}if(_1b6f!=null&&_1b6f.node!=oThis.node){var _1b70=new draw2d.DragDropEvent();_1b70.initDragDropEvent("figuredrop",false,oThis);_1b6f.dispatchEvent(_1b70);}if(draw2d.Drag.currentTarget!=null){var _1b70=new draw2d.DragDropEvent();_1b70.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_1b70);draw2d.Drag.currentTarget=null;}var _1b71=new draw2d.DragDropEvent();_1b71.initDragDropEvent("dragend",false);oThis.dispatchEvent(_1b71);draw2d.Drag.currentCompartment=null;draw2d.Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _1b75=this.targets.get(i);if(_1b75.node.isOver(x,y)&&_1b75.node!=this.node){return _1b75;}}return null;};draw2d.Draggable.prototype.getCompartment=function(x,y){var _1b78=null;for(var i=0;i<this.node.workflow.compartments.getSize();i++){var _1b7a=this.node.workflow.compartments.get(i);if(_1b7a.isOver(x,y)&&_1b7a!=this.node){if(_1b78==null){_1b78=_1b7a;}else{if(_1b78.getZOrder()<_1b7a.getZOrder()){_1b78=_1b7a;}}}}return _1b78==null?null:_1b78.dropable;};draw2d.Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};draw2d.Draggable.prototype.getTop=function(){return this.element.offsetTop;};draw2d.DragDropEvent=function(){draw2d.Event.call(this);};draw2d.DragDropEvent.prototype=new draw2d.Event();draw2d.DragDropEvent.prototype.initDragDropEvent=function(sType,_1b7c,_1b7d){this.initEvent(sType,_1b7c);this.relatedTarget=_1b7d;};draw2d.DropTarget=function(_1b7e){draw2d.EventTarget.call(this);this.construct(_1b7e);};draw2d.DropTarget.prototype=new draw2d.EventTarget;draw2d.DropTarget.prototype.construct=function(_1b7f){this.element=_1b7f;};draw2d.DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!=null){ol+=el.offsetLeft;}return ol;};draw2d.DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!=null){ot+=el.offsetTop;}return ot;};draw2d.DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};draw2d.DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};